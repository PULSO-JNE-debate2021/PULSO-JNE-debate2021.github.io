---
title: "PERU: DIEZ AÑOS DESPUES"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(sf)
library(ggplot2)
library(ggpubr)
library(tidyverse)
library(sf)
library(ggrepel)
library(repr)
debatable=readRDS("dataJNE.rds")
debamap=read_sf("regiones.shp")
debamap=merge(debamap,debatable,
              by.x='DEPARTAMEN',by.y="Departamento")

debamap <- debamap %>% mutate(centroid = map(geometry, st_centroid), coords = map(centroid,                                                                                        st_coordinates), coords_x = map_dbl(coords, 1), coords_y = map_dbl(coords, 2))

base=ggplot(data=debamap) + theme_void()  + scale_fill_brewer(palette = "YlOrBr",drop=FALSE)
#names(debamap)
```

```{r plotsCode_ACTUAL, warning=FALSE, message=FALSE}

# [35] "Sin_seguro_de_salud_2017_cat"                        
# [36] "Tasa_de_empleo_informal_2019_cat"                     
# [37] "Analfabetismo_2017_cat"                               
# [38] "Sin_Agua_Red_publica_2017_cat"                        
# [39] "Sin_Alumbrado_electrico_por_red_publica_2017_cat"     
# [40] "Vivienda_alquilada_2017_cat"                          
# [41] "Hogares_sin_TIC_2017_cat"                             
# [42] "Hogares_con_ninos_que_no_asisten_a_la_escuela_2017_cat"
# [43] "Hogares_con_viviendas_con_hacinamiento_2017_cat"

segu2017=base + geom_sf(aes(fill=Sin_seguro_de_salud_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Sin_seguro_de_salud_2017_cat=="Alarmante"|debamap$Sin_seguro_de_salud_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
segu2017=segu2017 + labs(fill="Porcentaje (%)")

info2017=base + geom_sf(aes(fill=Tasa_de_empleo_informal_2019_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Tasa_de_empleo_informal_2019_cat=="Alarmante"|
                                                  debamap$Tasa_de_empleo_informal_2019_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
info2017=info2017 + labs(fill="Porcentaje (%)",
                     title = "Tasa de empleo informal",subtitle = "2019")


analf2017=base + geom_sf(aes(fill=Analfabetismo_2017_cat)) +
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Analfabetismo_2017_cat=="Alarmante"|
                                                  debamap$Analfabetismo_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
analf2017=analf2017 + labs(fill="Porcentaje (%)",
                     title = "Tasa de analfabetismo",subtitle = "2017")


agua2017=base + geom_sf(aes(fill=Sin_Agua_Red_publica_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Sin_Agua_Red_publica_2017_cat=="Alarmante"|
                                                  debamap$Sin_Agua_Red_publica_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
agua2017=agua2017 + labs(fill="Porcentaje (%)",
                     title = "Hogares sin acceso a agua", subtitle="Por red pública- 2017")


elec2017=base + geom_sf(aes(fill=Sin_Alumbrado_electrico_por_red_publica_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Sin_Alumbrado_electrico_por_red_publica_2017_cat=="Alarmante"|
                                                  debamap$Sin_Alumbrado_electrico_por_red_publica_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
elec2017=elec2017 + labs(fill="Porcentaje (%)",
                     title = "Hogares sin acceso a alumbrado eléctrico",subtitle = "Por red pública- 2017")


alqui2017=base + geom_sf(aes(fill=Vivienda_alquilada_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Vivienda_alquilada_2017_cat=="Alarmante"|
                                                  debamap$Vivienda_alquilada_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
alqui2017=alqui2017 + labs(fill="Porcentaje (%)",
                     title = "Viviendas alquiladas",subtitle = "2017")


tic2017=base + geom_sf(aes(fill=Hogares_sin_TIC_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Hogares_sin_TIC_2017_cat=="Alarmante"|
                                                  debamap$Hogares_sin_TIC_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
tic2017=tic2017 + labs(fill="Porcentaje (%)",
                     title = "Hogares sin TIC", subtitle = "2017")


servhig2017=base + geom_sf(aes(fill=Hogares_con_viviendas_sin_servicios_higienicos_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Hogares_con_viviendas_sin_servicios_higienicos_2017_cat=="Alarmante"|
                                                  debamap$Hogares_con_viviendas_sin_servicios_higienicos_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
servhig2017=servhig2017 + labs(fill="Porcentaje (%)",
                     title = "Hogar sin servicios higiénicos",subtitle = "2017")


haci2017=base + geom_sf(aes(fill=Hogares_con_viviendas_con_hacinamiento_2017_cat))+
                      geom_text_repel(mapping = aes(coords_x, coords_y, label = DEPARTAMEN),
                                      data=debamap[debamap$Hogares_con_viviendas_con_hacinamiento_2017_cat=="Alarmante"|
                                                  debamap$Hogares_con_viviendas_con_hacinamiento_2017_cat=="Crítico",],
                                      size = 2,
                                      fontface = 'bold')
haci2017=haci2017 + labs(fill="Porcentaje (%)",
                     title = "Hogares en hacinamiento",subtitle = "2017")


```



```{r plotsCode_CAMBIOS, warning=FALSE, message=FALSE}
segu=base + geom_sf(aes(fill=pob_sin_seguro_salud_cat))
segu=segu + labs(fill ="Cambio en %")

info=base + geom_sf(aes(fill=pob_empleo_informal_cat))
info=info + labs(fill="Cambio en %",
                 title = "Tasa de empleo informal",subtitle = "Avances entre 2008- 2019")

analf=base + geom_sf(aes(fill=pob_analfabetismo_cat)) 
analf=analf + labs(fill="Cambio en %",title = "Tasa de analfabetismo",subtitle = "Avances entre 2007- 2017")

agua=base + geom_sf(aes(fill=viv_sin_agua_cat)) 
agua=agua + labs(fill="Cambio en %",title = "Hogares sin acceso a agua",subtitle = "Avances entre 2007- 2017")

elec=base + geom_sf(aes(fill=viv_sin_electricidad_cat)) 
elec=elec + labs(fill="Cambio en %",title = "Hogares sin acceso a alumbrado eléctrico",subtitle = "Avances entre 2007- 2017")

alqui=base + geom_sf(aes(fill=viv_alquilada_cat)) 
alqui=alqui + labs(fill="Cambio en %",title = "Viviendas alquiladas",subtitle = "Avances entre 2007- 2017")

tic=base + geom_sf(aes(fill=hog_sin_TIC_cat)) 
tic=tic + labs(fill="Cambio en %",title = "Hogares sin TIC",subtitle = "Avances entre 2007- 2017")

servhig=base + geom_sf(aes(fill=hog_sin_servhigie_cat)) 
servhig=servhig + labs(fill="Cambio en %",title = "Hogar sin servicios higiénicos",subtitle = "Avances entre 2007- 2017")
 
haci=base + geom_sf(aes(fill=hog_hacinamiento_cat)) 
haci=haci + labs(fill="Cambio en %",title = "Hogares en hacinamiento",subtitle = "Avances entre 2007- 2017")

```




**CAMBIOS EN INDICADORES SOCIALES** 
=====================================


Column {data-width=180}
-------------------------------------
    
### **NOTAS**

* Categorias a la actualidad (2017 o el mayor año):

  + Aceptable: No más del 10% de la población cumple con la condición.
  + Preocupante: Entre el 10% y 25% de la población cumple con la condición.
  + Alarmante: Entre el 25% y 50% de la población cumple con la condición. 
  + Crítico: Al menos el 50% de la población cumple con la condición.


* Datos utilizados:

  + **Cobertura de los servicios de salud**
    - 2007: Censos Nacionales 2007: XI de Población y VI de Vivienda. Recuperado de http://censos.inei.gob.pe/Censos2007/redatam/
    - 2017: Censos Nacionales 2017: XII de Población, VII de Vivienda y III de Comunidades Indígenas. Recuperado de https://censos2017.inei.gob.pe/redatam/ 
  + **Trabajo decente**
    - Perú: Evolución de los Indicadores de Empleo e Ingreso por Departamento, 2007-2019. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1790/libro.pdf 
  + **Alfabetización** 
    - Tasa de analfabetismo de la población de 15 y más años, según ámbito geográfico. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1758/cap05/cap05057.xlsx 

* Avances: Es el resultado de la diferencia entre la cifra del indel 2017, o el mayor año, y la cifra del 2007, o el menor año, en puntos porcentuales. 

  + **< -25**: La diferencia supera los 25 puntos porcentuales. Supone una importante mejora.
  + **-10 a -25**: La diferencia oscila entre los 10 y 25 puntos porcentuales.Supone una mejora intermedia. 
  + **-10 a 0**: La diferencia oscila entre los 0 y 10 puntos porcentuales.Supone ningún cambio o una leve mejora. 
  + **0 a 10**: La diferencia implica un leve retroceso de entre 1 y 10 puntos porcentuales. 
  + **10 a 25**: La diferencia implica un retroceso intermedio de entre 1 y 10 puntos porcentuales.
  + **> 25**: La diferencia implica un importante retroceso, de - al menos - 25 puntos porcentuales.
  
Column {.tabset}
-------------------------------------

### **Cobertura de los servicios de salud**

```{r, fig.height = 5, fig.width = 8, fig.align = "center"}

titulo="Población sin seguro de salud"
abajo="Elaborado por PULSO PUCP para la DNEF-JNE"
ggarrange(
  segu2017, NULL,  segu,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("2017","" ,"Avances entre 2007- 2017"),hjust = 0,
  label.x=c(0.4,0,0.3), font.label = list(size = 14, 
                                        face = "bold", 
                                        color ="blue")
  )%>%annotate_figure(top = text_grob(titulo,
                                      color = "blue", 
                                      face = "bold",
                                      size = 20),
                      bottom = text_grob(abajo, 
                                         color = "blue",
                                         hjust = 1, 
                                         x = 1, face = "bold", size = 14)
               #,fig.lab = "Figure 1", fig.lab.face = "bold"
)
```



### **Trabajo decente**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  info2017, NULL,  info,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```


### **Alfabetización**


```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  analf2017, NULL,  analf,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```


**CAMBIOS EN INDICADORES DE VIVIENDA** 
=====================================


Column {data-width=180}
-------------------------------------
    
### **NOTAS**

* Categorias a la actualidad (2017 o el mayor año):

  + Aceptable: No más del 10% de la población cumple con la condición.
  + Preocupante: Entre el 10% y 25% de la población cumple con la condición.
  + Alarmante: Entre el 25% y 50% de la población cumple con la condición. 
  + Crítico: Al menos el 50% de la población cumple con la condición.


* Datos utilizados:

  + **Acceso a agua**
    - Perfil Sociodemográfico del Perú. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1539/ 
  + **Acceso a servicios energéticos**
    - Proporción de la población que tiene acceso a la electricidad. Recuperado de http://ods.inei.gob.pe/ods/objetivos-de-desarrollo-sostenible/energia-asequible-y-no-contaminante 
  + **Tenencia de vivienda** 
    - 2007: Censos Nacionales 2007: XI de Población y VI de Vivienda. Recuperado de http://censos.inei.gob.pe/Censos2007/redatam/
    - 2017: Censos Nacionales 2017: XII de Población, VII de Vivienda y III de Comunidades Indígenas. Recuperado de https://censos2017.inei.gob.pe/redatam/ 

* Avances: Es el resultado de la diferencia entre la cifra del 2017, o el mayor año, y la cifra del 2007, o el menor año. 

  + **< -25**: La diferencia supera los 25 puntos porcentuales. Supone una importante mejora.
  + **-10 a -25**: La diferencia oscila entre los 10 y 25 puntos porcentuales.Supone una mejora intermedia. 
  + **-10 a 0**: La diferencia oscila entre los 0 y 10 puntos porcentuales.Supone ningún cambio o una leve mejora. 
  + **0 a 10**: La diferencia implica un leve retroceso de entre 1 y 10 puntos porcentuales. 
  + **10 a 25**: La diferencia implica un retroceso intermedio de entre 1 y 10 puntos porcentuales.
  + **> 25**: La diferencia implica un importante retroceso, de - al menos - 25 puntos porcentuales.

Column {.tabset}
-------------------------------------

### **Acceso a agua**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  agua2017, NULL,  agua,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )

```


### **Acceso a servicios energéticos**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  elec2017, NULL,  elec,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```

### **Tenencia de vivienda**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  alqui2017, NULL,  alqui,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )

```


**CAMBIOS EN INDICADORES DE HOGAR** 
=====================================


Column {data-width=180}
-------------------------------------
    
### **NOTAS**

* Categorias a la actualidad (2017 o el mayor año):

  + Aceptable: No más del 10% de la población cumple con la condición.
  + Preocupante: Entre el 10% y 25% de la población cumple con la condición.
  + Alarmante: Entre el 25% y 50% de la población cumple con la condición. 
  + Crítico: Al menos el 50% de la población cumple con la condición.


* Datos utilizados:

  + **Acceso a Tecnologías de la Información y Comunicaciones**
    - Perfil Sociodemográfico del Perú. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1539/ 
  + **Acceso a servicios básicos**
    - Perú: Mapa de Necesidades Básicas Insatisfechas, 1993, 2007 y 2017. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1588/
  + **Acceso a vivienda adecuada** 
    - Perú: Mapa de Necesidades Básicas Insatisfechas, 1993, 2007 y 2017. Recuperado de https://www.inei.gob.pe/media/MenuRecursivo/publicaciones_digitales/Est/Lib1588/


* Avances: Es el resultado de la diferencia entre la cifra del 2017, o el mayor año, y la cifra del 2007, o el menor año. 

  + **< -25**: La diferencia supera los 25 puntos porcentuales. Supone una importante mejora.
  + **-10 a -25**: La diferencia oscila entre los 10 y 25 puntos porcentuales.Supone una mejora intermedia. 
  + **-10 a 0**: La diferencia oscila entre los 0 y 10 puntos porcentuales.Supone ningún cambio o una leve mejora. 
  + **0 a 10**: La diferencia implica un leve retroceso de entre 1 y 10 puntos porcentuales. 
  + **10 a 25**: La diferencia implica un retroceso intermedio de entre 1 y 10 puntos porcentuales.
  + **> 25**: La diferencia implica un importante retroceso, de - al menos - 25 puntos porcentuales.

Column {.tabset}
-------------------------------------

### **Acceso a Tecnologías de la Información y Comunicaciones**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  tic2017, NULL,  tic,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```


### **Acceso a servicios básicos**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  servhig2017, NULL, servhig,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```

### **Acceso a vivienda adecuada**

```{r,fig.height = 5, fig.width = 8, fig.align = "center"}
ggarrange(
  haci2017, NULL,haci,
  nrow = 1, widths = c(1, 0.1, 1),
  labels = c("", "", "")
  )
```
